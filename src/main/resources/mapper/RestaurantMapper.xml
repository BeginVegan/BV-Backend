<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.beginvegan.mybatis.RestaurantMapper">

    <select id="selectAllRestaurant" resultType="RestaurantDTO">
        SELECT * FROM Restaurant;
    </select>

    <select id="selectRestaurantByRestaurantNo" parameterType="int" resultType="RestaurantDTO">
        SELECT * FROM Restaurant
        WHERE restaurant_no = #{restaurantNo};
    </select>

    <insert id="insertRestaurant" parameterType="restaurantDTO" useGeneratedKeys="true" keyProperty="restaurantNo">
        INSERT INTO Restaurant (restaurant_name, restaurant_address, restaurant_address_gu, restaurant_x, restaurant_y, restaurant_open, restaurant_close, restaurant_detail, restaurant_avg_price, restaurant_table, restaurant_table_member, restaurant_vegan_level, restaurant_photo_dir, restaurant_star)
        VALUES (#{restaurantName}, #{restaurantAddress}, #{restaurantAddressGu}, #{restaurantX}, #{restaurantY}, #{restaurantOpen, typeHandler=org.apache.ibatis.type.TimeOnlyTypeHandler}, #{restaurantClose, typeHandler=org.apache.ibatis.type.TimeOnlyTypeHandler}, #{restaurantDetail}, #{restaurantAvgPrice}, #{restaurantTable}, #{restaurantTableMember}, #{restaurantVeganLevel}, #{restaurantPhotoDir}, 0)
    </insert>

    <insert id="insertRestaurantMenu" parameterType="java.util.Map">
        INSERT INTO Menu (restaurant_no, menu_name, menu_price, menu_category, menu_detail, menu_photo_dir)
        VALUES
        <foreach collection="list" item="item" separator=",">
        (
            #{restaurantNo},
            #{item.menuName},
            #{item.menuPrice},
            #{item.menuCategory},
            #{item.menuDetail},
            #{item.menuPhotoDir}
        )
        </foreach>
    </insert>

    <delete id="deleteRestaurant" parameterType="int">
        DELETE FROM Restaurant
        WHERE restaurant_no = #{restaurantNo}
    </delete>


    <!-- 아래는 테스트를 위한 쿼리문입니다. -->
    <select id="selectMaxRestaurantNoTest" resultType="int">
        SELECT MAX(restaurant_no) FROM Restaurant;
    </select>

    <select id="selectRestaurantCntTest" resultType="int">
        SELECT COUNT(*) FROM Restaurant;
    </select>
</mapper>